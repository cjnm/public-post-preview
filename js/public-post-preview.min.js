!function(e,i,t){var p={initialize:function(){var i=this;i.checkbox=e("#public-post-preview"),i.link=e("#public-post-preview-link"),i.linkInput=i.link.find("input"),i.nonce=e("#public_post_preview_wpnonce"),i.status=e("#public-post-preview-ajax"),i.expirySection=e("#public-post-preview-expiry"),i.expiryTypeSelect=e("#public-post-preview-expiry-type"),i.customTimeDiv=e("#public-post-preview-custom-time"),i.daysInput=e("#public-post-preview-days"),i.hoursInput=e("#public-post-preview-hours"),i.minutesInput=e("#public-post-preview-minutes"),i.savedMsg=e("#public-post-preview-saved-msg"),i.expiryTimeDisplay=e("#public-post-preview-expiry-time"),i.expiryDisplayMain=e("#public-post-preview-expiry-display"),i.previousExpiryType=i.expiryTypeSelect.val(),console.log("DSPublicPostPreview initialized",{checkbox:i.checkbox.length,expiryTypeSelect:i.expiryTypeSelect.length,expiryTypeValue:i.expiryTypeSelect.val(),customTimeDiv:i.customTimeDiv.length}),i.status.css("opacity",0),i.checkbox.bind("change",(function(){i.change()})),i.expiryTypeSelect.on("change",(function(){i.toggleCustomTime(),i.saveExpirySettings()})),i.daysInput.on("change",(function(){i.updateExpiryDisplay(),i.saveExpirySettings()})),i.hoursInput.on("change",(function(){i.updateExpiryDisplay(),i.saveExpirySettings()})),i.minutesInput.on("change",(function(){i.updateExpiryDisplay(),i.saveExpirySettings()})),i.linkInput.on("focus",(function(){e(this).select()})),i.updateExpiryDisplay(),e("#post").on("submit",(function(){i.expiryTypeSelect.length&&i.expiryTypeSelect.prop("disabled",!1),i.daysInput.length&&i.daysInput.prop("disabled",!1),i.hoursInput.length&&i.hoursInput.prop("disabled",!1),i.minutesInput.length&&i.minutesInput.prop("disabled",!1)}))},change:function(){var i=this,p=i.checkbox.prop("checked")?"true":"false";i.checkbox.prop("disabled","disabled"),i.request({_ajax_nonce:i.nonce.val(),checked:p,post_ID:e("#post_ID").val()},(function(e){e.success&&("true"===p?(i.status.text(t.enabled),i._pulsate(i.status,"green")):(i.status.text(t.disabled),i._pulsate(i.status,"red")),e.data&&e.data.preview_url?i.linkInput.val(e.data.preview_url):i.linkInput.val(""),i.link.toggleClass("ppp-hidden"),i.expirySection.toggleClass("ppp-hidden")),i.checkbox.prop("disabled","")}))},toggleCustomTime:function(){var e=this,i=e.expiryTypeSelect.val();if(console.log("Toggle custom time, type:",i),"custom"===i){if(e.customTimeDiv.removeClass("ppp-hidden"),e.daysInput.prop("disabled",!1),e.hoursInput.prop("disabled",!1),e.minutesInput.prop("disabled",!1),"custom"!==e.previousExpiryType&&!e.daysInput.val()&&!e.hoursInput.val()&&!e.minutesInput.val())return e.hoursInput.val(48),e.saveExpirySettings(),void(e.previousExpiryType=i)}else e.customTimeDiv.addClass("ppp-hidden"),e.daysInput.prop("disabled",!0),e.hoursInput.prop("disabled",!0),e.minutesInput.prop("disabled",!0);e.previousExpiryType=i,e.saveExpirySettings()},updateExpiryDisplay:function(){var e=this,i=e.expiryTypeSelect.val(),t=(parseInt(e.expiryTypeSelect.data("expiry-timestamp")),parseInt(e.expiryTypeSelect.data("preview-created"))||0);if(e.expiryTimeDisplay.text(""),e.expiryDisplayMain.text(""),"always"!==i){if("48hours"!==i){if("custom"===i){var p=parseInt(e.daysInput.val())||0,s=parseInt(e.hoursInput.val())||0,n=parseInt(e.minutesInput.val())||0;if(0===p&&0===s&&0===n)return void e.expiryTimeDisplay.text("Preview has expired");var a=new Date;r={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},o=new Date(a.getTime()+24*p*60*60*1e3+60*s*60*1e3+60*n*1e3).toLocaleDateString("en-US",r),e.expiryTimeDisplay.text("Expires on: "+o)}}else if(t>0){var r={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},o=new Date(1e3*(t+172800)).toLocaleDateString("en-US",r);e.expiryDisplayMain.text("Expires on: "+o)}}else e.expiryDisplayMain.text("Preview will never expire")},saveExpirySettings:function(){var t=this;if(t.checkbox.prop("checked")){var p=e("#post_ID").val(),s=t.expiryTypeSelect.val(),n=parseInt(t.daysInput.val())||0,a=parseInt(t.hoursInput.val())||0,r=parseInt(t.minutesInput.val())||0,o=t.nonce.val();console.log("Saving expiry settings:",{postId:p,expiryType:s,days:n,hours:a,minutes:r,nonce:o});var u={action:"public-post-preview-save-expiry",_ajax_nonce:o,post_ID:p,expiry_type:s,days:n,hours:a,minutes:r};e.ajax({type:"POST",url:i,data:u,success:function(e){console.log("Save response:",e),t.savedMsg.stop(!0,!0).show().delay(3e3).fadeOut()},error:function(e){console.log("Save error:",e),t.status.text("Error saving settings"),t._pulsate(t.status,"red")}})}else console.log("Preview not checked, skipping save")},request:function(t,p){e.ajax({type:"POST",url:i,data:e.extend(t,{action:"public-post-preview"}),success:p})},_pulsate:function(e,i){e.css("color",i).animate({opacity:1},600,"linear").animate({opacity:0},600,"linear",(function(){e.empty()}))}};e(p.initialize())}(window.jQuery,window.ajaxurl,window.DSPublicPostPreviewL10n);