!function(e,t,i){var p={initialize:function(){var t=this;t.checkbox=e("#public-post-preview"),t.link=e("#public-post-preview-link"),t.linkInput=t.link.find("input"),t.copyBtn=e("#public-post-preview-copy-btn"),t.regenerateBtn=e("#public-post-preview-regenerate-btn"),t.linkMsg=e("#public-post-preview-link-msg"),t.nonce=e("#public_post_preview_wpnonce"),t.status=e("#public-post-preview-ajax"),t.expirySection=e("#public-post-preview-expiry"),t.expiryTypeSelect=e("#public-post-preview-expiry-type"),t.customTimeDiv=e("#public-post-preview-custom-time"),t.daysInput=e("#public-post-preview-days"),t.hoursInput=e("#public-post-preview-hours"),t.minutesInput=e("#public-post-preview-minutes"),t.savedMsg=e("#public-post-preview-saved-msg"),t.expiryTimeDisplay=e("#public-post-preview-expiry-time"),t.expiryDisplayMain=e("#public-post-preview-expiry-display"),t.previousExpiryType=t.expiryTypeSelect.val(),console.log("DSPublicPostPreview initialized",{checkbox:t.checkbox.length,expiryTypeSelect:t.expiryTypeSelect.length,expiryTypeValue:t.expiryTypeSelect.val(),customTimeDiv:t.customTimeDiv.length}),t.status.css("opacity",0),t.checkbox.bind("change",(function(){t.change()})),t.copyBtn.on("click",(function(){t.copyLink()})),t.regenerateBtn.on("click",(function(){t.regenerateLink()})),t.expiryTypeSelect.on("change",(function(){t.toggleCustomTime(),t.updateExpiryDisplay(),t.saveExpirySettings()})),t.daysInput.on("change",(function(){t.updateExpiryDisplay(),t.saveExpirySettings()})),t.hoursInput.on("change",(function(){t.updateExpiryDisplay(),t.saveExpirySettings()})),t.minutesInput.on("change",(function(){t.updateExpiryDisplay(),t.saveExpirySettings()})),t.linkInput.on("focus",(function(){e(this).select()})),t.updateExpiryDisplay(),e("#post").on("submit",(function(){t.expiryTypeSelect.length&&t.expiryTypeSelect.prop("disabled",!1),t.daysInput.length&&t.daysInput.prop("disabled",!1),t.hoursInput.length&&t.hoursInput.prop("disabled",!1),t.minutesInput.length&&t.minutesInput.prop("disabled",!1)}))},change:function(){var t=this,p=t.checkbox.prop("checked")?"true":"false";t.checkbox.prop("disabled","disabled"),t.request({_ajax_nonce:t.nonce.val(),checked:p,post_ID:e("#post_ID").val()},(function(e){e.success&&("true"===p?(t.status.text(i.enabled),t._pulsate(t.status,"green")):(t.status.text(i.disabled),t._pulsate(t.status,"red")),e.data&&e.data.preview_url?t.linkInput.val(e.data.preview_url):t.linkInput.val(""),t.link.toggleClass("ppp-hidden"),t.expirySection.toggleClass("ppp-hidden")),t.checkbox.prop("disabled","")}))},toggleCustomTime:function(){var e=this,t=e.expiryTypeSelect.val();if(console.log("Toggle custom time, type:",t),"custom"===t){e.customTimeDiv.removeClass("ppp-hidden"),e.daysInput.prop("disabled",!1),e.hoursInput.prop("disabled",!1),e.minutesInput.prop("disabled",!1);var i=e.daysInput.val(),p=e.hoursInput.val(),n=e.minutesInput.val();if("custom"!==e.previousExpiryType&&""===i&&""===p&&""===n)return e.hoursInput.val(48),e.updateExpiryDisplay(),e.saveExpirySettings(),void(e.previousExpiryType=t)}else e.customTimeDiv.addClass("ppp-hidden"),e.daysInput.prop("disabled",!0),e.hoursInput.prop("disabled",!0),e.minutesInput.prop("disabled",!0);e.previousExpiryType=t,e.updateExpiryDisplay(),e.saveExpirySettings()},updateExpiryDisplay:function(){var e=this,t=e.expiryTypeSelect.val(),i=(parseInt(e.expiryTypeSelect.data("expiry-timestamp")),parseInt(e.expiryTypeSelect.data("preview-created"))||0);if(e.expiryTimeDisplay.text(""),e.expiryDisplayMain.text(""),"always"!==t){if("48hours"!==t){if("custom"===t){var p=parseInt(e.daysInput.val())||0,n=parseInt(e.hoursInput.val())||0,s=parseInt(e.minutesInput.val())||0;if(0===p&&0===n&&0===s)return void e.expiryTimeDisplay.text("Preview has expired");var a=new Date;o={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},r=new Date(a.getTime()+24*p*60*60*1e3+60*n*60*1e3+60*s*1e3).toLocaleDateString("en-US",o),e.expiryTimeDisplay.text("Expires on: "+r)}}else if(i>0){var o={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},r=new Date(1e3*(i+172800)).toLocaleDateString("en-US",o);e.expiryDisplayMain.text("Expires on: "+r)}}else e.expiryDisplayMain.text("Preview will never expire")},saveExpirySettings:function(){var i=this;if(i.checkbox.prop("checked")){var p=e("#post_ID").val(),n=i.expiryTypeSelect.val(),s=parseInt(i.daysInput.val())||0,a=parseInt(i.hoursInput.val())||0,o=parseInt(i.minutesInput.val())||0,r=i.nonce.val();console.log("Saving expiry settings:",{postId:p,expiryType:n,days:s,hours:a,minutes:o,nonce:r});var l={action:"public-post-preview-save-expiry",_ajax_nonce:r,post_ID:p,expiry_type:n,days:s,hours:a,minutes:o};e.ajax({type:"POST",url:t,data:l,success:function(e){console.log("Save response:",e),i.savedMsg.stop(!0,!0).show().delay(3e3).fadeOut()},error:function(e){console.log("Save error:",e),i.status.text("Error saving settings"),i._pulsate(i.status,"red")}})}else console.log("Preview not checked, skipping save")},regenerateLink:function(){var i=this,p=e("#post_ID").val(),n=i.nonce.val();console.log("Regenerating preview link for post:",p);var s={action:"public-post-preview-regenerate-link",_ajax_nonce:n,post_ID:p};e.ajax({type:"POST",url:t,data:s,success:function(e){console.log("Regenerate response:",e),e.success&&e.data&&e.data.preview_url&&(i.linkInput.val(e.data.preview_url),i.linkMsg.text("New link generated! Old link no longer works.").stop(!0,!0).show().delay(5e3).fadeOut())},error:function(e){console.log("Regenerate error:",e),i.linkMsg.text("Error regenerating link").stop(!0,!0).show().delay(5e3).fadeOut()}})},copyLink:function(){var e=this,t=e.linkInput.val();t&&(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then((function(){e.linkMsg.text("Link copied to clipboard!").stop(!0,!0).show().delay(3e3).fadeOut()})).catch((function(){e.selectAndCopy()})):e.selectAndCopy())},selectAndCopy:function(){var e=this;e.linkInput.select();try{document.execCommand("copy"),e.linkMsg.text("Link copied to clipboard!").stop(!0,!0).show().delay(3e3).fadeOut()}catch(t){e.linkMsg.text("Failed to copy link").stop(!0,!0).show().delay(3e3).fadeOut()}},request:function(i,p){e.ajax({type:"POST",url:t,data:e.extend(i,{action:"public-post-preview"}),success:p})},_pulsate:function(e,t){e.css("color",t).animate({opacity:1},600,"linear").animate({opacity:0},600,"linear",(function(){e.empty()}))}};e(p.initialize())}(window.jQuery,window.ajaxurl,window.DSPublicPostPreviewL10n);